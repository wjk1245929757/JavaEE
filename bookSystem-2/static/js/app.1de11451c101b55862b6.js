webpackJsonp([1],{"65OK":function(t,e){},"7+rw":function(t,e){},NHnr:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o("7+uW"),n=o("zL8q"),l=o.n(n),r=(o("tvR6"),{render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]});var i=o("VU/8")({name:"App"},r,!1,function(t){o("zVsq")},null,null).exports,s=o("/ocq"),u=o("mtWM"),c=o.n(u),d={name:"Home",data:function(){return{tableData:[{bid:"??",bname:"??",author:"??",content:"??"}]}},methods:{handleClick1:function(t){console.log(t),this.$router.push({path:"/book/"+t.bid})},handleClick2:function(t){var e=this;console.log(t),c()({method:"delete",url:"http://localhost:8081/book/"+t.bid,headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("jwtToken")}}).then(function(t){console.log(t),e.$router.go(0)})},handleClick3:function(){this.$router.push("/BookDetail")},handleClick4:function(){this.$router.push("/Admin")},getBookList:function(){var t=this;c()({method:"get",url:"http://localhost:8081/books",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("jwtToken")}}).then(function(e){console.log(e),t.tableData=e.data})}},mounted:function(){console.log(localStorage.getItem("jwtToken")),this.getBookList()}},p={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"back"},[o("div",{attrs:{id:"bg"}}),t._v(" "),o("div",{staticClass:"box2"},[o("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData}},[o("el-table-column",{attrs:{type:"index",width:"50"}}),t._v(" "),o("el-table-column",{attrs:{prop:"bname",label:"书名",width:"180"}}),t._v(" "),o("el-table-column",{attrs:{prop:"author",label:"作者",width:"180"}}),t._v(" "),o("el-table-column",{attrs:{prop:"content",label:"内容简介"}}),t._v(" "),o("el-table-column",{attrs:{label:"操作",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(o){return t.handleClick1(e.row)}}},[t._v("编辑")]),t._v(" "),o("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(o){return t.handleClick2(e.row)}}},[t._v("删除")])]}}])})],1)],1),t._v(" "),o("br"),t._v(" "),o("el-button",{attrs:{type:"button"},on:{click:function(e){return t.handleClick3()}}},[t._v("添加")]),t._v(" "),o("el-button",{attrs:{type:"button"},on:{click:function(e){return t.handleClick4()}}},[t._v("个人中心")])],1)},staticRenderFns:[]};var m=o("VU/8")(d,p,!1,function(t){o("ucA4")},"data-v-538083c0",null).exports,h={name:"Register",data:function(){var t=this;return{labelPosition:"right",ruleForm:{pass:"",checkPass:"",mail:"",code:""},rules:{pass:[{validator:function(e,o,a){""===o?a(new Error("请输入密码")):(""!==t.ruleForm.checkPass&&t.$refs.ruleForm.validateField("checkPass"),/^(?![\d]+$)(?![a-zA-Z]+$)(?![^\da-zA-Z]+$)([^\u4e00-\u9fa5\s]){10,16}$/.test(o)||a(new Error("请输入10-16位英文字母、数字或者符号(除空格)，且字母、数字和标点符号至少包含两种")),a())},trigger:"blur"}],checkPass:[{validator:function(e,o,a){""===o?a(new Error("请再次输入密码")):o!==t.ruleForm.pass?a(new Error("两次输入密码不一致!")):a()},trigger:"blur"}],mail:[{validator:function(t,e,o){var a=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;if(!e)return o(new Error("邮箱不能为空"));setTimeout(function(){a.test(e)?o():o(new Error("请输入正确的邮箱格式"))},100)},trigger:"blur"}],code:[{validator:function(t,e,o){var a=sessionStorage.getItem("checkCode");return console.log(a),e?a!==e?o(new Error("验证码错误")):void o():o(new Error("验证码不能为空"))},trigger:"blur"}]}}},methods:{getCode:function(){""===this.ruleForm.mail?this.$message.error("请先输入邮箱再点击获取验证码"):c()({method:"post",url:"http://localhost:8081/sendCheckCode",data:{email:this.ruleForm.mail}}).then(function(t){sessionStorage.setItem("checkCode",t.data),console.log(t)})},submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;c.a.post("http://localhost:8081/register",{email:e.ruleForm.mail,password:e.ruleForm.pass}).then(function(t){console.log(t),"注册成功"===t.data?e.$router.back():"账号已存在"===t.data&&alert("账号已存在")})})},resetForm:function(t){this.$refs[t].resetFields()}}},f={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"back"},[o("div",{attrs:{id:"bg"}}),t._v(" "),o("div",{staticClass:"back2"},[o("div",{staticClass:"box1"},[t._v("\n      注册\n    ")]),t._v(" "),o("hr"),t._v(" "),o("div",{staticClass:"box3"},[t._v("\n      没有账号，点击"),o("router-link",{attrs:{id:"Login",to:"/Login"}},[t._v("登录")])],1),t._v(" "),o("div",{staticClass:"box2"},[o("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:t.ruleForm,"status-icon":"",rules:t.rules,"label-width":"100px",id:"block","label-position":t.labelPosition}},[o("el-form-item",{attrs:{label:"邮箱",prop:"mail",id:"ei"}},[o("el-input",{attrs:{"prefix-icon":"el-icon-user-solid"},model:{value:t.ruleForm.mail,callback:function(e){t.$set(t.ruleForm,"mail",e)},expression:"ruleForm.mail"}})],1),t._v(" "),o("el-form-item",{attrs:{inline:!0,label:"验证码",prop:"code",id:"eissss"}},[o("el-col",{attrs:{span:11}},[o("el-input",{staticStyle:{width:"100%"},attrs:{"prefix-icon":"el-icon-s-promotion"},model:{value:t.ruleForm.code,callback:function(e){t.$set(t.ruleForm,"code",t._n(e))},expression:"ruleForm.code"}})],1),t._v(" "),o("el-col",{attrs:{span:13}},[o("el-button",{attrs:{type:"info",icon:"el-icon-message",circle:""},on:{click:function(e){return t.getCode()}}})],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"密码",prop:"pass",id:"eis"}},[o("el-input",{attrs:{"prefix-icon":"el-icon-key",type:"password",autocomplete:"off"},model:{value:t.ruleForm.pass,callback:function(e){t.$set(t.ruleForm,"pass",e)},expression:"ruleForm.pass"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"确认密码",prop:"checkPass",id:"eiss"}},[o("el-input",{attrs:{"prefix-icon":"el-icon-key",type:"password",autocomplete:"off"},model:{value:t.ruleForm.checkPass,callback:function(e){t.$set(t.ruleForm,"checkPass",e)},expression:"ruleForm.checkPass"}})],1),t._v(" "),o("el-form-item",{attrs:{id:"but"}},[o("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm("ruleForm")}}},[t._v("提交")]),t._v(" "),o("el-button",{on:{click:function(e){return t.resetForm("ruleForm")}}},[t._v("重置")])],1)],1)],1)])])},staticRenderFns:[]};var b=o("VU/8")(h,f,!1,function(t){o("YiVf")},"data-v-3566fb43",null).exports,v=o("mw3O"),k=o.n(v),g={name:"Login",data:function(){var t=this;return{labelPosition:"right",ruleForm:{pass:"",account:""},zhud:!1,loading:!1,rules:{pass:[{validator:function(e,o,a){""===o?a(new Error("请输入密码")):(""!==t.ruleForm.checkPass&&t.$refs.ruleForm.validateField("checkPass"),a())},trigger:"blur"}],account:[{validator:function(t,e,o){var a=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;if(!e)return o(new Error("邮箱不能为空"));setTimeout(function(){a.test(e)?o():o(new Error("请输入正确的邮箱格式"))},100)},trigger:"blur"}]}}},methods:{submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;console.log(e.ruleForm.account+e.ruleForm.pass);var o={email:e.ruleForm.account,password:e.ruleForm.pass};c.a.post("http://localhost:8081/login",k.a.stringify(o)).then(function(t){console.log(t.data),"Success"===t.data.data?(alert("Success"),e.$message.success("登录成功"),localStorage.setItem("jwtToken",t.data.jwtToken),e.$router.replace("/Home")):"账号不存在"===t.data.data?alert("账号不存在"):"密码错误"===t.data.data?alert("密码错误"):alert("?????")})})},resetForm:function(t){this.$refs[t].resetFields()}}},F={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"back"},[o("div",{attrs:{id:"bg"}}),t._v(" "),o("div",{staticClass:"back2"},[o("div",{staticClass:"box1"},[t._v("\n      登录\n    ")]),t._v(" "),o("hr"),t._v(" "),o("div",{staticClass:"box3"},[t._v("\n      没有账号，点击"),o("router-link",{attrs:{id:"Register",to:"/Register"}},[t._v("注册")])],1),t._v(" "),o("div",{staticClass:"box2"},[o("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:t.ruleForm,"status-icon":"",rules:t.rules,"label-width":"100px",id:"block","label-position":t.labelPosition}},[o("el-form-item",{attrs:{label:"邮箱",prop:"account",id:"ei"}},[o("el-input",{attrs:{"prefix-icon":"el-icon-user-solid"},model:{value:t.ruleForm.account,callback:function(e){t.$set(t.ruleForm,"account",e)},expression:"ruleForm.account"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"密码",prop:"pass",id:"eis"}},[o("el-input",{attrs:{"prefix-icon":"el-icon-key",type:"password",autocomplete:"off"},model:{value:t.ruleForm.pass,callback:function(e){t.$set(t.ruleForm,"pass",e)},expression:"ruleForm.pass"}})],1),t._v(" "),o("el-form-item",{attrs:{id:"but"}},[o("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm("ruleForm")}}},[t._v("登录")]),t._v(" "),o("el-button",{on:{click:function(e){return t.resetForm("ruleForm")}}},[t._v("重置")])],1)],1)],1)])])},staticRenderFns:[]};var _=o("VU/8")(g,F,!1,function(t){o("65OK")},"data-v-0d7d12e8",null).exports,w={name:"BookDetail",data:function(){return{fileIsNull:!1,formData:new FormData,fileData:null,updateBookForm:{bid:"",bname:"",author:"",content:"",path:""}}},methods:{getBook:function(){var t=this;if(void 0===this.$route.params.bid)console.log(this.$route.params.bid),this.fileIsNull=!0;else{this.updateBookForm.bid=this.$route.params.bid;var e={bid:this.updateBookForm.bid},o="http://localhost:8081/books/"+this.updateBookForm.bid;c()({method:"get",url:o,headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("jwtToken")},data:e}).then(function(e){console.log(e),t.updateBookForm=e.data,console.log(e.data.path),null===t.updateBookForm.path&&(t.fileIsNull=!0)})}},updateBook:function(){var t=this;console.log(this.updateBookForm.path),void 0===this.$route.params.bid?c()({method:"post",url:"http://localhost:8081/books",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("jwtToken")},data:this.updateBookForm}).then(function(e){console.log(e),t.updateBookForm.bid=e.data,null!==t.updateBookForm.path&&!0===t.fileIsNull&&t.uploadFile(),t.$router.push("/Home")}):c()({method:"put",url:"http://localhost:8081/book/"+this.updateBookForm.bid,headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("jwtToken")},data:this.updateBookForm}).then(function(e){console.log(e),"Success"===e.data&&(null!==t.updateBookForm.path&&!0===t.fileIsNull&&t.uploadFile(),t.$router.push("/Home"))})},back:function(){this.$router.push("/Home")},fileLoad:function(){var t=this,e=this.$refs.refFile.files[0];t.formData.append("file",e),console.log(this.$refs.refFile.files),t.updateBookForm.path=this.$refs.refFile.files[0].name;var o=new FileReader;o.readAsText(e),o.onload=function(){t.fileData=this.result,console.log(t.fileData)}},clickLoad:function(){this.clear_data(),this.$refs.refFile.dispatchEvent(new MouseEvent("click"))},clear_data:function(){this.fileData=null},uploadFile:function(){c()({method:"post",url:"http://localhost:8081/book/"+this.updateBookForm.bid+"/upload",data:this.formData,headers:{"Content-Type":"multipart/form-data",Authorization:localStorage.getItem("jwtToken")}}).then(function(t){console.log(t)})},downloadFile:function(){var t=document.createElement("a");t.href="http://localhost:8081/"+this.updateBookForm.path,t.click()},deleteFile:function(){var t=this;c()({method:"delete",url:"http://localhost:8081/book/"+this.updateBookForm.bid+"/delete",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("jwtToken")}}).then(function(e){console.log(e),t.$router.go(0)})}},mounted:function(){this.getBook()}},y={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"back"},[o("div",{attrs:{id:"bg"}}),t._v(" "),o("div",{staticClass:"back2"},[o("div",{attrs:{id:"box1"}},[o("el-form",{staticClass:"demo-form-inline",attrs:{model:t.updateBookForm}},[o("el-form-item",{attrs:{label:"书名"}},[o("el-input",{attrs:{placeholder:"请输入书名"},model:{value:t.updateBookForm.bname,callback:function(e){t.$set(t.updateBookForm,"bname",e)},expression:"updateBookForm.bname"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"作者"}},[o("el-input",{attrs:{placeholder:"请输入作者"},model:{value:t.updateBookForm.author,callback:function(e){t.$set(t.updateBookForm,"author",e)},expression:"updateBookForm.author"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"内容"}},[o("el-input",{attrs:{placeholder:"请输入内容",type:"textarea",autosize:{minRows:4,maxRows:8}},model:{value:t.updateBookForm.content,callback:function(e){t.$set(t.updateBookForm,"content",e)},expression:"updateBookForm.content"}})],1),t._v(" "),t.fileIsNull?o("div",[o("el-form-item",{attrs:{label:"源文件"}},[o("el-input",{attrs:{placeholder:this.updateBookForm.path,readonly:!0},model:{value:t.updateBookForm.path,callback:function(e){t.$set(t.updateBookForm,"path",e)},expression:"updateBookForm.path"}}),t._v(" "),o("el-button",{attrs:{type:"button"},on:{click:function(e){return t.clickLoad()}}},[t._v("选择上传文件")]),t._v(" "),o("input",{ref:"refFile",staticStyle:{display:"none"},attrs:{type:"file",id:"files"},on:{change:function(e){return t.fileLoad()}}})],1)],1):o("div",[o("div",[t._v(t._s(this.updateBookForm.path))]),t._v(" "),o("el-button",{attrs:{type:"button"},on:{click:function(e){return t.downloadFile()}}},[t._v("下载文件")]),t._v(" "),o("el-button",{attrs:{type:"button"},on:{click:function(e){return t.deleteFile()}}},[t._v("删除文件")])],1)],1),t._v(" "),o("br"),t._v(" "),o("el-button",{attrs:{type:"button",id:"fileCommit"},on:{click:function(e){return t.updateBook()}}},[t._v("提交")]),t._v(" "),o("el-button",{attrs:{type:"button"},on:{click:function(e){return t.back()}}},[t._v("返回")])],1)])])},staticRenderFns:[]};var C=o("VU/8")(w,y,!1,function(t){o("RMj/")},"data-v-aebb37b8",null).exports,$={name:"Admin",data:function(){return{isAdmin:!1,tableData:[{email:"??",password:"??",role:"??"}]}},methods:{handleClick1:function(t){var e=this;console.log(t);for(var o=-1,a=0;a<this.tableData.length;a++)this.tableData[a].email===t.email&&(o=a);c()({method:"put",url:"http://localhost:8081/admin/user/"+t.email,headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("jwtToken")},data:this.tableData[o]}).then(function(t){console.log(t),"401"===t.data.status&&(console.log(t.data.status),e.updateUser()),e.$message.success("修改成功")})},handleClick2:function(t){var e=this;console.log(t),c()({method:"delete",url:"http://localhost:8081/admin/user/"+t.email,headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("jwtToken")}}).then(function(t){console.log(t),e.$router.go(0),"401"===t.data.status&&(console.log(t.data.status),e.deleteUser())})},handleClick3:function(){this.$router.go(0)},handleClick4:function(){var t=this;this.$prompt("请输入邮箱","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/[\w!#$%&'*+/=?^_`{|}~-]+(?:\.[\w!#$%&'*+/=?^_`{|}~-]+)*@(?:[\w](?:[\w-]*[\w])?\.)+[\w](?:[\w-]*[\w])?/,inputErrorMessage:"邮箱格式不正确"}).then(function(e){var o=e.value,a={email:o,password:"123456",role:"ROLE_USER"};t.tableData.push(a),c()({method:"post",url:"http://localhost:8081/admin/users",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("jwtToken")},data:a}).then(function(e){console.log(e),t.$router.go(0)}),t.$message({type:"success",message:"你的邮箱是: "+o})}).catch(function(){t.$message({type:"info",message:"取消输入"})})},handleClick5:function(){localStorage.clear(),this.$router.push("/Login")},tableDbEdit:function(t,e,o,a){console.log(t,e,o,a);var n=this;if("密码"===e.label||"角色"===e.label&&this.isAdmin){a.target.innerHTML="";var l=document.createElement("input");l.value="",l.setAttribute("type","text"),l.style.width="80%",l.style.padding="0px",l.style.border="1px solid #288EFE",l.style.borderRadius="3px",o.appendChild(l),l.onblur=function(){if(""===l.value&&"字段名"===e.label)this.$message.warning("字段名不能为空"),l.style.border="1px solid #FD1B1E";else if(o.removeChild(l),a.target.innerHTML=l.value,"密码"===e.label)for(var r=0;r<n.tableData.length;r++)n.tableData[r].email===t.email&&(n.tableData[r].password=l.value);else for(var i=0;i<n.tableData.length;i++)n.tableData[i].email===t.email&&(n.tableData[i].role=l.value)}}},getUserList:function(){var t=this;c()({method:"get",url:"http://localhost:8081/admin/users",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("jwtToken")}}).then(function(e){console.log(e),"401"===e.data.status?(console.log(e.data.status),t.getUser()):(t.isAdmin=!0,t.tableData=e.data)})},getUser:function(){var t=this;c()({method:"get",url:"http://localhost:8081/user/user",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("jwtToken")}}).then(function(e){console.log(e),"401"===e.data.status?(console.log(e.data.status),t.$router.push("/Login")):(t.tableData=[],t.tableData.push(e.data))})},updateUser:function(){console.log(this.tableData[0]),c()({method:"put",url:"http://localhost:8081/user/user",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("jwtToken")},data:this.tableData[0]}).then(function(t){console.log(t)})},deleteUser:function(){c()({method:"delete",url:"http://localhost:8081/user/user",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("jwtToken")}}).then(function(t){console.log(t)})}},mounted:function(){console.log(localStorage.getItem("jwtToken")),this.getUserList()}},B={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"back"},[o("div",{attrs:{id:"bg"}}),t._v(" "),o("div",{staticClass:"box2"},[o("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData},on:{"cell-dblclick":t.tableDbEdit}},[o("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),t._v(" "),o("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),t._v(" "),o("el-table-column",{attrs:{prop:"password",label:"密码"}}),t._v(" "),o("el-table-column",{attrs:{prop:"role",label:"角色"}}),t._v(" "),o("el-table-column",{attrs:{label:"操作",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(o){return t.handleClick1(e.row)}}},[t._v("修改")]),t._v(" "),o("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(o){return t.handleClick2(e.row)}}},[t._v("删除")])]}}])})],1)],1),t._v(" "),o("div",[o("br"),t._v(" "),o("el-button",{attrs:{type:"button"},on:{click:function(e){return t.handleClick3()}}},[t._v("刷新")])],1),t._v(" "),t.isAdmin?o("div",[o("br"),t._v(" "),o("el-button",{attrs:{type:"button"},on:{click:function(e){return t.handleClick4()}}},[t._v("添加")])],1):t._e(),t._v(" "),o("div",[o("br"),t._v(" "),o("el-button",{attrs:{type:"button"},on:{click:function(e){return t.handleClick5()}}},[t._v("退出")])],1)])},staticRenderFns:[]};var x=o("VU/8")($,B,!1,function(t){o("7+rw")},"data-v-a7f1bd16",null).exports;a.default.use(s.a);var T=new s.a({routes:[{path:"/",name:"Login",component:_},{path:"/Home",name:"Home",component:m},{path:"/Login",name:"Login",component:_},{path:"/Register",name:"Register",component:b},{path:"/book/:bid",name:"BookDetail",component:C},{path:"/BookDetail",name:"BookDetail",component:C},{path:"/Admin",name:"Admin",component:x}]});a.default.prototype.$http=c.a,a.default.use(l.a),a.default.config.productionTip=!1,new a.default({el:"#app",router:T,components:{App:i},template:"<App/>"})},"RMj/":function(t,e){},YiVf:function(t,e){},tvR6:function(t,e){},ucA4:function(t,e){},zVsq:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.1de11451c101b55862b6.js.map